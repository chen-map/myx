<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户管理系统</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<div class="container">
    <h1>用户管理系统</h1>

    <!-- 添加用户区域 -->
    <div class="card">
        <h2>添加用户</h2>
        <form id="addUserForm">
            <div class="form-group">
                <label for="username">用户名：</label>
                <input type="text" id="username" name="username" required>
            </div>
            <div class="form-group">
                <label for="password">密码：</label>
                <input type="password" id="password" name="password" required>
            </div>
            <div class="form-group">
                <label for="email">邮箱：</label>
                <input type="email" id="email" name="email" required>
            </div>
            <button type="submit" class="btn">添加用户</button>
        </form>
    </div>

    <!-- 查询用户区域 -->
    <div class="card">
        <h2>查询用户</h2>
        <div class="form-group">
            <label for="queryId">用户ID：</label>
            <input type="number" id="queryId" name="queryId" required>
            <button id="queryBtn" class="btn">查询</button>
        </div>
        <div id="userInfo" class="hidden">
            <h3>用户信息</h3>
            <p><strong>ID：</strong><span id="infoId"></span></p>
            <p><strong>用户名：</strong><span id="infoUsername"></span></p>
            <p><strong>邮箱：</strong><span id="infoEmail"></span></p>
            <button id="deleteBtn" class="btn danger">删除用户</button>
        </div>
    </div>

    <!-- 提示信息 -->
    <div id="message" class="hidden"></div>
</div>

<script>
    // 后端API路径（因前端嵌入Spring Boot，可直接用相对路径）
    const API_ADD = "/user/add";
    const API_QUERY = "/user/find/";
    const API_DELETE = "/user/delete/";

    // DOM元素
    const addUserForm = document.getElementById("addUserForm");
    const queryBtn = document.getElementById("queryBtn");
    const deleteBtn = document.getElementById("deleteBtn");
    const userInfo = document.getElementById("userInfo");
    const message = document.getElementById("message");
    let currentUserId = null; // 存储当前查询的用户ID

    // 显示提示信息
    function showMessage(text, isSuccess = true) {
        message.className = isSuccess ? "success" : "error";
        message.textContent = text;
        message.classList.remove("hidden");
        setTimeout(() => {
            message.classList.add("hidden");
        }, 3000);
    }

    // 添加用户
    addUserForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const userData = {
            username: document.getElementById("username").value,
            password: document.getElementById("password").value,
            email: document.getElementById("email").value
        };

        try {
            const response = await fetch(API_ADD, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(userData)
            });
            if (response.ok) {
                showMessage("用户添加成功！");
                addUserForm.reset();
            } else {
                showMessage("添加失败，请检查输入", false);
            }
        } catch (error) {
            showMessage("网络错误，请稍后重试", false);
        }
    });

    // 查询用户
    queryBtn.addEventListener("click", async () => {
        const userId = document.getElementById("queryId").value;
        if (!userId) {
            showMessage("请输入用户ID", false);
            return;
        }

        try {
            const response = await fetch(API_QUERY + userId);
            if (response.ok) {
                const user = await response.json();
                currentUserId = userId;
                document.getElementById("infoId").textContent = user.id;
                document.getElementById("infoUsername").textContent = user.username;
                document.getElementById("infoEmail").textContent = user.email;
                userInfo.classList.remove("hidden");
                showMessage("查询成功");
            } else if (response.status === 404) {
                userInfo.classList.add("hidden");
                showMessage("用户不存在", false);
            } else {
                userInfo.classList.add("hidden");
                showMessage("查询失败", false);
            }
        } catch (error) {
            showMessage("网络错误，请稍后重试", false);
        }
    });

    // 删除用户
    deleteBtn.addEventListener("click", async () => {
        if (!currentUserId || !confirm("确定要删除该用户吗？")) {
            return;
        }

        try {
            const response = await fetch(API_DELETE + currentUserId, {
                method: "DELETE"
            });
            if (response.ok) {
                userInfo.classList.add("hidden");
                document.getElementById("queryId").value = "";
                currentUserId = null;
                showMessage("用户删除成功");
            } else {
                showMessage("删除失败", false);
            }
        } catch (error) {
            showMessage("网络错误，请稍后重试", false);
        }
    });
</script>
</body>
</html>